<!DOCTYPE html>
<html lang="fr" x-data x-cloak x-init="$store.app.loadZones()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AgriMoist Pro</title>
  <link rel="stylesheet" href="/src/css/styles.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
</head>
<body class="font-inter bg-gray-50 dark:bg-dark-bg text-gray-800 dark:text-gray-200">

  <!-- HEADER -->
  <header class="bg-white dark:bg-dark-panel shadow">
    <div class="container mx-auto flex justify-between items-center p-4">
      <h1 class="text-2xl font-bold text-primary">AgriMoist Pro</h1>
      <div class="flex items-center gap-4">
        <!-- Bouton Actualiser -->
        <button
          @click="$store.app.loadZones()"
          class="px-3 py-1 bg-primary text-white rounded-lg hover:bg-primary/80 transition"
        >üîÑ Actualiser</button>
        <!-- Bouton Mode sombre/clair -->
        <button
          @click="$store.app.toggleTheme()"
          class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition"
        ><span x-text="$store.app.isDark ? 'üåû' : 'üåô'"></span></button>
      </div>
    </div>
  </header>

  <!-- LOADER OVERLAY -->
  <div
    x-show="$store.app.isLoading"
    class="loader-overlay"
    x-cloak
  >
    <div class="loading-spinner"></div>
  </div>

  <!-- MAIN -->
  <main class="container mx-auto p-4 space-y-8" x-show="!$store.app.isLoading">
    <!-- NAVIGATION VUES -->
    <nav class="flex gap-6 mb-4">
      <button
        @click="$store.app.currentView = 'dashboard';"
        :class="{'text-primary border-b-2 border-primary': $store.app.currentView==='dashboard'}"
        class="pb-1 hover:text-primary transition"
      >Dashboard</button>
      <button
        @click="$store.app.currentView = 'analytics';"
        :class="{'text-primary border-b-2 border-primary': $store.app.currentView==='analytics'}"
        class="pb-1 hover:text-primary transition"
      >Analytics</button>
      <button
        @click="$store.app.currentView = 'alerts';"
        :class="{'text-primary border-b-2 border-primary': $store.app.currentView==='alerts'}"
        class="pb-1 hover:text-primary transition"
      >Alertes</button>
      <button
        @click="$store.app.currentView = 'map';"
        :class="{'text-primary border-b-2 border-primary': $store.app.currentView==='map'}"
        class="pb-1 hover:text-primary transition"
      >Carte</button>
      <button
        @click="$store.app.currentView = 'zoneDetail';"
        :class="{'text-primary border-b-2 border-primary': $store.app.currentView==='zoneDetail'}"
        class="pb-1 hover:text-primary transition"
      >D√©tail</button>
    </nav>

    <!-- DASHBOARD -->
    <section x-show="$store.app.currentView==='dashboard'">
      <!-- Metrics -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="metric-card from-green-400 via-green-500 to-green-600">
          <div>
            <p class="uppercase text-sm opacity-75">Zones Actives</p>
            <p class="text-3xl font-bold" x-text="$store.app.zones.length"></p>
          </div>
          <span class="text-4xl opacity-30">üåæ</span>
        </div>
        <div class="metric-card from-blue-400 via-blue-500 to-blue-600">
          <div>
            <p class="uppercase text-sm opacity-75">Humidit√© Moyenne</p>
            <p class="text-3xl font-bold" x-text="`${$store.app.averageMoisture.toFixed(1)}%`"></p>
          </div>
          <span class="text-4xl opacity-30">üíß</span>
        </div>
        <div class="metric-card from-red-400 via-red-500 to-red-600">
          <div>
            <p class="uppercase text-sm opacity-75">Alertes Actives</p>
            <p class="text-3xl font-bold" x-text="$store.app.activeAlerts.length"></p>
          </div>
          <span class="text-4xl opacity-30">‚ö†Ô∏è</span>
        </div>
      </div>
      <!-- Charts -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="chart-card">
          <!-- <h2 class="text-lg font-semibold mb-2">Tendance Zone</h2> -->
          <canvas id="zoneChart"></canvas>
        </div>
        <div class="chart-card">
          <!-- <h2 class="text-lg font-semibold mb-2">Comparaison Zones</h2> -->
          <canvas id="comparisonChart"></canvas>
        </div>
      </div>
    </section>

    <!-- ANALYTICS -->
<section
x-show="!$store.app.isLoading && $store.app.currentView==='analytics'"
class="space-y-8"
>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  <!-- 1. Statuts en premier -->
  <div class="chart-card">
    <h2 class="text-lg font-semibold mb-2"></h2>
    <canvas id="statusChart"></canvas>
  </div>

  <!-- 2. Puis la tendance -->
  <div class="chart-card">
    <h2 class="text-lg font-semibold mb-2"></h2>
    <canvas id="trendChart"></canvas>
  </div>
</div>
</section>


    <!-- ALERTES -->
    <section x-show="$store.app.currentView==='alerts'" class="space-y-6">
      <h2 class="text-2xl font-semibold mb-4">Toutes les Alertes</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <template x-for="alert in $store.app.activeAlerts" :key="alert.id">
          <div class="alert-card">
            <div>
              <h3 class="font-semibold" x-text="alert.name"></h3>
              <p class="text-sm" x-text="`Type: ${alert.type}`"></p>
              <p class="text-sm" x-text="`Humidit√©: ${alert.moisture}%`"></p>
            </div>
            <button
              @click="$store.app.currentView='zoneDetail'"
              class="text-primary hover:underline"
            >Voir zone</button>
          </div>
        </template>
      </div>
    </section>

    <!-- CARTE -->
    <section x-show="$store.app.currentView==='map'">
      <div class="chart-card p-0">
        <div id="map"></div>
      </div>
    </section>

    <!-- D√âTAIL ZONE -->
    <section x-show="$store.app.currentView==='zoneDetail'" class="space-y-6">
      <h2 class="text-2xl font-semibold" x-text="$store.app.selectedZone.name"></h2>
      <p x-text="`Humidit√© actuelle: ${$store.app.selectedZone.moisture}%`"></p>
      <div class="chart-card p-0">
        <canvas id="zoneChart"></canvas>
      </div>
    </section>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script type="module" src="/src/js/app.js"></script>
</body>
</html>
